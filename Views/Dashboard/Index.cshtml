@model POSRestoran01.Models.ViewModels.DashboardViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="flex h-screen bg-gray-100">
    <!-- Main Content -->
    <div class="flex-1 p-6 overflow-y-auto">
        <!-- Header -->
        <div class="mb-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>
                    <p class="text-gray-600">@Model.SelectedDate.ToString("dddd, dd MMMM yyyy")</p>
                </div>
                <div class="flex items-center space-x-4">
                    <input type="date" id="dateFilter" value="@Model.SelectedDate.ToString("yyyy-MM-dd")"
                           class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Total Revenue -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Total Pendapatan</p>
                        <p class="text-3xl font-bold text-green-600" id="totalRevenue">
                            @Model.TotalRevenue.ToString("C", new System.Globalization.CultureInfo("id-ID"))
                        </p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-money-bill-wave text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Total Menu Dipesan -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Total Menu Dipesan</p>
                        <p class="text-3xl font-bold text-blue-600" id="totalMenusOrdered">@Model.TotalMenusOrdered</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-utensils text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Total Customer -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Total Customer</p>
                        <p class="text-3xl font-bold text-purple-600" id="totalCustomers">@Model.TotalCustomers</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Order Report -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">Order Report</h2>
                            <div class="flex items-center space-x-2">
                                <select id="statusFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-blue-500">
                                    <option value="">Semua Status</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Preparing">Preparing</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Canceled">Canceled</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <div id="orderReportTable" class="overflow-x-auto">
                            <!-- Order report table will be loaded here -->
                            @await Html.PartialAsync("_OrderReportPartial", Model.OrderReports)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="space-y-6">
                <!-- Popular Menu -->
                <div class="bg-white rounded-lg shadow-md">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">Paling Banyak Dipesan</h3>
                            <div class="flex space-x-1">
                                <button onclick="loadPopularMenus('today')" class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded popular-filter" data-filter="today">Hari Ini</button>
                                <button onclick="loadPopularMenus('week')" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded popular-filter" data-filter="week">Minggu Ini</button>
                                <button onclick="loadPopularMenus('month')" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded popular-filter" data-filter="month">Bulan Ini</button>
                            </div>
                        </div>
                    </div>
                    <div class="p-4" id="popularMenuContainer">
                        @await Html.PartialAsync("_PopularMenuPartial", Model.PopularMenus)
                    </div>
                </div>

                <!-- Order Type Stats -->
                <div class="bg-white rounded-lg shadow-md">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">Jenis Order</h3>
                            <div class="flex space-x-1">
                                <button onclick="loadOrderTypeStats('today')" class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded ordertype-filter" data-filter="today">Hari Ini</button>
                                <button onclick="loadOrderTypeStats('week')" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded ordertype-filter" data-filter="week">Minggu Ini</button>
                                <button onclick="loadOrderTypeStats('month')" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded ordertype-filter" data-filter="month">Bulan Ini</button>
                            </div>
                        </div>
                    </div>
                    <div class="p-4" id="orderTypeStatsContainer">
                        @await Html.PartialAsync("_OrderTypeStatsPartial", Model.OrderTypeStats)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Order Detail Modal -->
<div id="orderDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
        <div class="p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Detail Order</h3>
                <button onclick="hideOrderDetailModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div id="orderDetailContent">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-40">
    <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
        <span class="text-gray-700">Memproses...</span>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
        });

        function initializeDashboard() {
            console.log('Dashboard initialized');
            // Load initial data
            loadOrderReports();
        }

        function setupEventListeners() {
            // Date filter change
            const dateFilter = document.getElementById('dateFilter');
            if (dateFilter) {
                dateFilter.addEventListener('change', function() {
                    const selectedDate = this.value;
                    if (selectedDate) {
                        // Use POST request to avoid URL issues
                        updateDashboardData(selectedDate);
                    }
                });
            }

            // Status filter change
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', function() {
                    loadOrderReports();
                });
            }
        }

        function updateDashboardData(selectedDate) {
            showLoading();

            fetch(`/Dashboard/GetDashboardData?date=${selectedDate}`)
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        // Update the stats cards
                        updateStatsCards(data.data);
                        // Reload all sections
                        loadOrderReports();
                        loadPopularMenus('today');
                        loadOrderTypeStats('today');
                    } else {
                        showNotification(data.message || 'Terjadi kesalahan', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error updating dashboard data:', error);
                    showNotification('Terjadi kesalahan saat memuat data dashboard', 'error');
                });
        }

        function updateStatsCards(data) {
            const totalRevenueEl = document.getElementById('totalRevenue');
            const totalMenusOrderedEl = document.getElementById('totalMenusOrdered');
            const totalCustomersEl = document.getElementById('totalCustomers');

            if (totalRevenueEl) totalRevenueEl.textContent = formatCurrency(data.totalRevenue);
            if (totalMenusOrderedEl) totalMenusOrderedEl.textContent = data.totalMenusOrdered || 0;
            if (totalCustomersEl) totalCustomersEl.textContent = data.totalCustomers;
        }

        function loadOrderReports() {
            const dateFilter = document.getElementById('dateFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            const params = new URLSearchParams();
            if (dateFilter) {
                params.append('startDate', dateFilter);
                params.append('endDate', dateFilter);
            }
            if (statusFilter) {
                params.append('status', statusFilter);
            }
            params.append('page', 1);
            params.append('pageSize', 10);

            fetch(`/Dashboard/GetOrderReports?${params.toString()}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderOrderReports(data.data);
                    } else {
                        showNotification(data.message || 'Terjadi kesalahan', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error loading order reports:', error);
                    showNotification('Terjadi kesalahan saat memuat laporan order', 'error');
                });
        }

        function renderOrderReports(orders) {
            const container = document.getElementById('orderReportTable');
            if (!orders || orders.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Tidak ada data order</div>';
                return;
            }

            let html = `
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-3 px-2 font-semibold text-gray-700">Customer</th>
                            <th class="text-left py-3 px-2 font-semibold text-gray-700">Menu</th>
                            <th class="text-left py-3 px-2 font-semibold text-gray-700">Total</th>
                            <th class="text-left py-3 px-2 font-semibold text-gray-700">Status</th>
                            <th class="text-left py-3 px-2 font-semibold text-gray-700">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            orders.forEach(order => {
                const statusClass = getStatusClass(order.status);
                html += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-3 px-2">
                            <div>
                                <div class="font-medium">${order.customerName || 'Guest'}</div>
                                <div class="text-sm text-gray-500">${order.orderNumber}</div>
                            </div>
                        </td>
                        <td class="py-3 px-2">
                            <div class="text-sm text-gray-600 truncate max-w-xs">${order.menuSummary}</div>
                        </td>
                        <td class="py-3 px-2 font-semibold">${formatCurrency(order.total)}</td>
                        <td class="py-3 px-2">
                            <span class="px-2 py-1 text-xs rounded-full ${statusClass}">${order.status}</span>
                        </td>
                        <td class="py-3 px-2">
                            <div class="flex space-x-2">
                                <select onchange="updateOrderStatus(${order.orderId}, this.value)" class="text-xs border rounded px-2 py-1">
                                    <option value="">Ubah Status</option>
                                    <option value="Pending" ${order.status === 'Pending' ? 'disabled' : ''}>Pending</option>
                                    <option value="Preparing" ${order.status === 'Preparing' ? 'disabled' : ''}>Preparing</option>
                                    <option value="Completed" ${order.status === 'Completed' ? 'disabled' : ''}>Completed</option>
                                    <option value="Canceled" ${order.status === 'Canceled' ? 'disabled' : ''}>Canceled</option>
                                </select>
                                <button onclick="showOrderDetail(${order.orderId})"
                                        class="text-blue-600 hover:text-blue-800 text-sm">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function getStatusClass(status) {
            switch (status) {
                case 'Pending': return 'bg-yellow-100 text-yellow-800';
                case 'Preparing': return 'bg-blue-100 text-blue-800';
                case 'Completed': return 'bg-green-100 text-green-800';
                case 'Canceled': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR'
            }).format(amount);
        }

        function updateOrderStatus(orderId, status) {
            if (!status) return;

            if (!confirm(`Apakah Anda yakin ingin mengubah status order ini menjadi ${status}?`)) {
                return;
            }

            const formData = new FormData();
            formData.append('orderId', orderId);
            formData.append('status', status);
            formData.append('__RequestVerificationToken', getAntiForgeryToken());

            showLoading();

            fetch('/Dashboard/UpdateOrderStatus', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadOrderReports();
                } else {
                    showNotification(data.message || 'Terjadi kesalahan', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error updating order status:', error);
                showNotification('Terjadi kesalahan saat mengubah status order', 'error');
            });
        }

        function showOrderDetail(orderId) {
            showLoading();

            fetch(`/Dashboard/GetOrderDetails?orderId=${orderId}`)
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        renderOrderDetail(data.data);
                        document.getElementById('orderDetailModal').classList.remove('hidden');
                        document.getElementById('orderDetailModal').classList.add('flex');
                    } else {
                        showNotification(data.message || 'Terjadi kesalahan', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error loading order details:', error);
                    showNotification('Terjadi kesalahan saat memuat detail order', 'error');
                });
        }

        function renderOrderDetail(order) {
            const content = document.getElementById('orderDetailContent');
            let html = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Order Number</label>
                            <p class="text-sm text-gray-900">${order.orderNumber}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Customer</label>
                            <p class="text-sm text-gray-900">${order.customerName || 'Guest'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Order Type</label>
                            <p class="text-sm text-gray-900">${order.orderType}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Table No</label>
                            <p class="text-sm text-gray-900">${order.tableNo || '-'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Date & Time</label>
                            <p class="text-sm text-gray-900">${order.orderDate} ${order.orderTime}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Status</label>
                            <span class="px-2 py-1 text-xs rounded-full ${getStatusClass(order.status)}">${order.status}</span>
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Kasir</label>
                            <p class="text-sm text-gray-900">${order.cashier || 'Unknown'}</p>
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Items</label>
                        <div class="space-y-2">
            `;

            order.items.forEach(item => {
                html += `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <div class="flex-1">
                            <p class="font-medium">${item.itemName}</p>
                            ${item.orderNote ? `<p class="text-sm text-gray-500">Note: ${item.orderNote}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <p class="font-medium">${item.quantity} x ${formatCurrency(item.unitPrice)}</p>
                            <p class="text-sm text-gray-500">${formatCurrency(item.subtotal)}</p>
                        </div>
                    </div>
                `;
            });

            html += `
                        </div>
                    </div>

                    <div class="border-t pt-4 space-y-2">
                        <div class="flex justify-between">
                            <span>Subtotal:</span>
                            <span>${formatCurrency(order.subtotal)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Discount:</span>
                            <span>-${formatCurrency(order.discount)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>PPN (11%):</span>
                            <span>${formatCurrency(order.ppn)}</span>
                        </div>
                        <div class="flex justify-between font-bold text-lg border-t pt-2">
                            <span>Total:</span>
                            <span>${formatCurrency(order.total)}</span>
                        </div>
                    </div>
                </div>
            `;

            content.innerHTML = html;
        }

        function hideOrderDetailModal() {
            document.getElementById('orderDetailModal').classList.add('hidden');
            document.getElementById('orderDetailModal').classList.remove('flex');
        }

        function loadPopularMenus(period) {
            // Update active filter button
            document.querySelectorAll('.popular-filter').forEach(btn => {
                if (btn.dataset.filter === period) {
                    btn.classList.remove('bg-gray-100', 'text-gray-600');
                    btn.classList.add('bg-blue-100', 'text-blue-600');
                } else {
                    btn.classList.remove('bg-blue-100', 'text-blue-600');
                    btn.classList.add('bg-gray-100', 'text-gray-600');
                }
            });

            const params = new URLSearchParams();
            const today = new Date();
            const dateFilter = document.getElementById('dateFilter').value;

            if (period === 'today') {
                const targetDate = dateFilter || today.toISOString().split('T')[0];
                params.append('startDate', targetDate);
                params.append('endDate', targetDate);
            } else if (period === 'week') {
                const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                params.append('startDate', weekAgo.toISOString().split('T')[0]);
                params.append('endDate', today.toISOString().split('T')[0]);
            } else if (period === 'month') {
                const monthAgo = new Date(today.getFullYear(), today.getMonth(), 1);
                params.append('startDate', monthAgo.toISOString().split('T')[0]);
                params.append('endDate', today.toISOString().split('T')[0]);
            }

            fetch(`/Dashboard/GetPopularMenus?${params.toString()}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderPopularMenus(data.data);
                    } else {
                        showNotification(data.message || 'Terjadi kesalahan', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error loading popular menus:', error);
                    showNotification('Terjadi kesalahan saat memuat menu populer', 'error');
                });
        }

        function renderPopularMenus(menus) {
            const container = document.getElementById('popularMenuContainer');
            if (!menus || menus.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-chart-bar text-2xl mb-2"></i>
                        <p class="text-sm">Tidak ada data menu populer</p>
                    </div>
                `;
                return;
            }

            let html = '';
            menus.forEach((menu, index) => {
                html += `
                    <div class="flex items-center space-x-3 py-2 ${index < menus.length - 1 ? 'border-b border-gray-100' : ''}">
                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                            <span class="text-sm font-semibold text-blue-600">${index + 1}</span>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-sm">${menu.itemName}</p>
                            <p class="text-xs text-gray-500">${menu.categoryName}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-sm">${menu.totalOrdered}</p>
                            <p class="text-xs text-gray-500">${formatCurrency(menu.revenue)}</p>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function loadOrderTypeStats(period) {
            // Update active filter button
            document.querySelectorAll('.ordertype-filter').forEach(btn => {
                if (btn.dataset.filter === period) {
                    btn.classList.remove('bg-gray-100', 'text-gray-600');
                    btn.classList.add('bg-blue-100', 'text-blue-600');
                } else {
                    btn.classList.remove('bg-blue-100', 'text-blue-600');
                    btn.classList.add('bg-gray-100', 'text-gray-600');
                }
            });

            const params = new URLSearchParams();
            const today = new Date();
            const dateFilter = document.getElementById('dateFilter').value;

            if (period === 'today') {
                const targetDate = dateFilter || today.toISOString().split('T')[0];
                params.append('startDate', targetDate);
                params.append('endDate', targetDate);
            } else if (period === 'week') {
                const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                params.append('startDate', weekAgo.toISOString().split('T')[0]);
                params.append('endDate', today.toISOString().split('T')[0]);
            } else if (period === 'month') {
                const monthAgo = new Date(today.getFullYear(), today.getMonth(), 1);
                params.append('startDate', monthAgo.toISOString().split('T')[0]);
                params.append('endDate', today.toISOString().split('T')[0]);
            }

            fetch(`/Dashboard/GetOrderTypeStats?${params.toString()}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderOrderTypeStats(data.data);
                    } else {
                        showNotification(data.message || 'Terjadi kesalahan', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error loading order type stats:', error);
                    showNotification('Terjadi kesalahan saat memuat statistik tipe order', 'error');
                });
        }

        function renderOrderTypeStats(stats) {
            const container = document.getElementById('orderTypeStatsContainer');
            if (!stats || stats.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-pie-chart text-2xl mb-2"></i>
                        <p class="text-sm">Tidak ada data tipe order</p>
                    </div>
                `;
                return;
            }

            let html = '';
            stats.forEach((stat, index) => {
                const color = stat.orderType === 'Dine In' ? 'bg-blue-500' : 'bg-green-500';
                html += `
                    <div class="flex items-center justify-between py-3 ${index < stats.length - 1 ? 'border-b border-gray-100' : ''}">
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 rounded-full ${color}"></div>
                            <span class="font-medium">${stat.orderType}</span>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold">${stat.count} (${stat.percentage.toFixed(1)}%)</p>
                            <p class="text-sm text-gray-500">${formatCurrency(stat.revenue)}</p>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Utility functions
        function showLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }
        }

        function showNotification(message, type = 'info', duration = 3000) {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;

            let bgColor, textColor, icon;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-500';
                    textColor = 'text-white';
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    bgColor = 'bg-red-500';
                    textColor = 'text-white';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-500';
                    textColor = 'text-white';
                    icon = 'fas fa-exclamation-triangle';
                    break;
                default:
                    bgColor = 'bg-blue-500';
                    textColor = 'text-white';
                    icon = 'fas fa-info-circle';
            }

            notification.className += ` ${bgColor} ${textColor}`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="${icon}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 10);

            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, duration);
        }

        function getAntiForgeryToken() {
            const tokenElement = document.querySelector('input[name="__RequestVerificationToken"]');
            return tokenElement ? tokenElement.value : '';
        }

        // Modal click outside to close
        document.addEventListener('click', function(e) {
            const orderDetailModal = document.getElementById('orderDetailModal');
            if (e.target === orderDetailModal) {
                hideOrderDetailModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                return;
            }

            switch (e.key) {
                case 'Escape':
                    e.preventDefault();
                    hideOrderDetailModal();
                    break;
                case 'r':
                case 'R':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        loadOrderReports();
                    }
                    break;
            }
        });
    </script>
}

@{
    @Html.AntiForgeryToken()
}